import uuid
from django.core.management.base import BaseCommand, CommandError
from django.contrib.auth.models import User
from arches.app.models.models import NodeGroup, Node
from arches.app.models.graph import Graph
from arches.app.models.tile import Tile

class Command(BaseCommand):

    help = '2021 June 8 - this command supports the transfer of existing '\
        '"Visiting Scout ID" nodes to a new node in the same tile. This new '\
        'node must be called "User Id" and it should use the username-widget, '\
        'which means that only values which are valid user names should be '\
        'transferred, all others should remain in the existing field and be logged.'

    def add_arguments(self, parser):
        # parser.add_argument("node",
        #     help='specify the name of the node whose values will be updated.'
        # )
        parser.add_argument("--set-value",
            help='the value to assign to the nodes.'
        )
        parser.add_argument("--set-empty",
            action="store_true",
            default=False,
            help='set all node values to empty. can be used to initialize '\
                 'newly created nodes. ERASES ALL EXISTING VALUES.'
        )



    def handle(self, *args, **options):

        valid_usernames = [i.username for i in User.objects.all()]
        valid_usernames = self.hms_usernames_june9_2021()

        # first get all of the existing tiles for this node group
        # note that both nodes (old and new) are in the same node group, so only
        # one group of tiles is needed.
        old_node = Node.objects.get(name="Visiting Scout ID")
        tiles = Tile.objects.filter(nodegroup_id=old_node.nodegroup)

        new_node = Node.objects.get(name="User ID")

        for tile in tiles:
            old_value = tile.data.get(str(old_node.nodeid), None)
            print(old_value)
            if old_value.lower() in valid_usernames:
                print("  match")
                new_value = old_value.lower()
            else:
                new_value = None
            print(f"{tile.resourceinstance_id}: {old_value} -- > {new_value}")


        # print(f"{tiles.count()} tiles to update")

        exit()

        nodeid = str(node.pk)
        for t in tiles:


            if options["set_empty"] or options["set_value"]:
                if options["set_empty"]:
                    new_value = None
                elif options["set_value"]:
                    new_value = options["set_value"]
                Tile().update_node_value(nodeid, new_value, tileid=t.tileid)
                print(f"{t.resourceinstance_id}: {old_value} --> {new_value}")
            else:
                print(f"{t.resourceinstance_id}: {old_value}")

        print(f"  tiles: {tiles.count()}")

    def hms_usernames_june9_2021(self):
        """this list is just used for testing purposes"""

        return [
            'anonymous',
            'FWC',
            'JWCorbettWMA',
            'BlackwaterRiverSP',
            'LakeStoneFishMA',
            'OkaloacoocheeSloughWMA',
            'PlattBranchWEA',
            'CaladesiIslandSP',
            'CayoCostaSP',
            'CedarKeyScrubStateReserve',
            'CurryHammockSP',
            'DadeBattlefieldHSP',
            'DonPedroIslandSP',
            'DudleyFarmHSP',
            'DunnsCreekSP',
            'EdwardBallWakullaSpringsSP',
            'FanningSpringsSP',
            'FortClinchSP',
            'HighlandsHammockSP',
            'HughTaylorBirchSP',
            'LakeJacksonSP',
            'MarjorieKinnanRawlingsHSP',
            'NatureCoastST',
            'OrmanHouseHSP',
            'OscarSchererSP',
            'PalatkatoStAugustineST',
            'SanFelascoHammockPreserveSP',
            'SkywayFishingPierSP',
            'StSebastianRiverPreserveSP',
            'StumpPassBeachSP',
            'TerraCeiaPreserveSP',
            'TroySpringSP',
            'WesSkilesPeacockSpringsSP',
            'OkeechobeeBattlefieldHSP',
            'AvalonSP',
            'CockroachBayPreserveSP',
            'AtlanticRidgePreserveSP',
            'LakeGriffinSP',
            'LakeLouisaSP',
            'BigLagoonSP',
            'FMSF',
            'AddisonBlockhouseHSP',
            'NorthPeninsulaSP',
            'FL_BAR',
            'IndianRiverLagoonPreserveSP',
            'BigTalbotIslandSP',
            'LittleTalbotIslandSP',
            'GeorgeCradyBridgeFishingPierSP',
            'FortGeorgeIslandCulturalSP',
            'IndianKeyHSP',
            'BaldPointSP',
            'BigShoalsSP',
            'BlueSpringSP',
            'BulowPlantationRuinsHSP',
            'CedarKeyMuseumSP',
            'CollierSeminoleSP',
            'ColtCreekSP',
            'DeerLakeSP',
            'DeLeonSpringsSP',
            'FakahatcheeStrandPreserveSP',
            'FaverDykesSP',
            'FernandinaPlazaHSP',
            'FortZacharyTaylorHSP',
            'GraytonBeachSP',
            'HendersonBeachSP',
            'HillsboroughRiverSP',
            'HoneymoonIslandSP',
            'HontoonIslandSP',
            'KissimmeePrairiePreserveSP',
            'LafayetteBlueSpringsSP',
            'LakeJuneinWinterScrubSP',
            'LakeKissimmeeSP',
            'LakeTalquinSP',
            'LittleManateeRiverSP',
            'LongKeySP',
            'MadisonBlueSpringSP',
            'NaturalBridgeBattlefieldHSP',
            'OchlockoneeRiverSP',
            'PoncedeLeonSpringsSP',
            'SavannasPreserveSP',
            'SeabranchPreserveSP',
            'SilverSpringsSP',
            'TarkilnBayouPreserveSP',
            'TopsailHillPreserveSP',
            'WeekiWacheeSpringsSP',
            'WekiwaSpringsSP',
            'WithlacoocheeST',
            'YborCityMuseumSP',
            'OletaRiverSP',
            'DelnorWigginsPassSP',
            'BahiaHondaSP',
            'CharlotteHarborPreserveSP',
            'FloridaKeysOverseasHeritageST',
            'WindleyKeySP',
            'SebastianInletSP',
            'AlfredBMaclayGardensSP',
            'GeneralJamesAVanFleetST',
            'DagnyJohnsonSP',
            'AllenDavidSP',
            'FloridaCavernsSP',
            'BlackwaterHeritageST',
            'ConstitutionConventionMuseumSP',
            'CrystalRiverArchaeologicalSP',
            'CrystalRiverPreserveSP',
            'DevilsMillhopperGeologicalSP',
            'DrJulianGBruceStGeorgeIslandSP',
            'DrVonDMizellEulaJohnsonSP',
            'EconfinaRiverSP',
            'EdenGardensSP',
            'FortCooperSP',
            'FortPierceInletSP',
            'GainesvilletoHawthorneST',
            'IchetuckneeSpringsSP',
            'JohnGorrieMuseumSP',
            'LakeManateeSP',
            'LoversKeySP',
            'MadiraBickelSP',
            'ManateeSpringsSP',
            'MarjorieHarrisST',
            'MyakkaRiverSP',
            'OlenoSP',
            'PalatkatoLakeButlerST',
            'PaynesPrairiePreserveSP',
            'RainbowSpringsSP',
            'RavineGardensSP',
            'RiverRisePreserveSP',
            'RockSpringsRunStateReserve',
            'SouthforkSP',
            'StAndrewsSP',
            'StephenFosterSP',
            'StLucieInletPreserveSP',
            'SuwanneeRiverWildernessST',
            'TallahasseeStMarksST',
            'TorreyaSP',
            'WaccasassaBayPreserveSP',
            'WingateCreekSP',
            'YellowRiverMarshPreserveSP',
            'SuwanneeRiverSP',
            'AdamsRanchACE1',
            'DeepCreekSF',
            'CampHelenSP',
            'EgmontKey',
            'FallingWatersSP',
            'ForestCapitalMuseumSP',
            'EllieSchillerSP',
            'JohnDMacArthurBeachSP',
            'FortMoseHSP',
            'AlafiaRiverSP',
            'GambleRogersSP',
            'BillBaggsCapeFloridaSP',
            'GasparillaIslandSP',
            'HawCreekPreserveSP',
            'JudahPHSP',
            'MikeRoessGoldHeadBranchSP',
            'OlusteeBattlefieldHSP',
            'PerdidoKeySP',
            'PumpkinHillCreekPreserveSP',
            'StMarksRiverPreserveSP',
            'TheBarnacleHSP',
            'ThreeRiversSP',
            'WashingtonOaksGardensSP',
            'WernerBoyceSaltSpringsSP',
            'YellowBluffFortHSP',
            'BigShoalsSF',
            'CarySF',
            'CharlesHBronsonSF',
            'CirclePinesFarmACE',
            'EvansACE',
            'FourCreeksSF',
            'JahreisRanchACE',
            'JBRanchACE',
            'JenningsSF',
            'KilbeeRanchACE',
            'KRockerACE',
            'LakeTalquinSF',
            'LittleBigEconSF',
            'NewnansLakeSF',
            'OkaloacoocheeSloughSF',
            'PhillipsMathisACE',
            'SeminoleSF',
            'SYHarttACENorth',
            'SYHarttACESouth',
            'CarlDuvalMooreSF',
            'adburke',
            'nmwright',
            'ecreetz',
            'PaynesCreekHSP',
            'SanPedroSP',
            'PineLogSF',
            'MoundKeyArchaeologicalSP',
            'nrudolph',
            'nhyarbrough',
            'tlgreen',
            'FredGannonRockyBayouSP',
            'LakeWalesRidgeSF',
            'HolopawSF',
            'eedietrich',
            'FisheatingCreekLykesBrothersCE',
            'IRCPublicShootingRange',
            'JonesHungrylandWEA',
            'TosohatcheeWMA',
            'FL_DEP',
            'CampLonesomeACE1',
            'CottageHillSF',
            'EtoniahCreekSF',
            'IndianLakeSF',
            'JohnMBetheaSF',
            'MyakkaSF',
            'PeaceRiverSF',
            'RalphESimmonsSF',
            'RossPrairieSF',
            'SmithFamilyFarmsACEs',
            'TatesHellSF',
            'WakullaSF',
            'WatsonIslandSF',
            'WithlacoocheeSF',
            'XLRanchACE',
            'CapeStGeorgeStateReserve',
            'RobertsProperty',
            'RookeryBayNERR',
            'RookeryBayReserveLands',
            'StJosephBayStateBufferPreserve',
            'TortugasEcologicalReserve',
            'WelakaSF',
            'semangram2',
            'BoxRWMA',
            'SpiritoftheWildWMA',
            'CaravelleRanchWMA',
            'BullfrogCreekWEA',
            'BrananFieldWEA',
            'EvergladesTaylorWMA',
            'seayersrigsby',
            'MarshViewPreserve',
            'AndrewsWMA',
            'ApalacheeWMA',
            'BelmoreSF',
            'ApalachicolaNERR',
            'MatanzasSF',
            'WestCentral',
            'jbclarke',
            'TigerBaySF',
            'LakeGeorgeSF',
            'kmdean',
            'GuanaTolomatoMatanzasNERR',
            'ejmurray',
            'ChinsegutWEA',
            'LKirkEdwardsWEA',
            'BigBendWMA',
            'FloridaKeysWEA',
            'FortWhiteWEA',
            'FWCMitigationParcel',
            'GrissomParkway',
            'HalfMoonWMA',
            'HilocheeWMA',
            'HoleyLandWMA',
            'JudgesCaveWEA',
            'LittleGatorCreekWEA',
            'MakinsonIslandCA',
            'MiccoExpansion',
            'MoodyBranchWEA',
            'MorganLakeWalesPreserveCBCE',
            'OspreyUnit',
            'PantherPassageCBCE',
            'ParadiseIsland',
            'PerryOldenburgWEA',
            'RotenbergerWMA',
            'SaltLakeWMA',
            'WatermelonPondWEA',
            'SplitOakForestWEA',
            'SuwanneeRidgeWEA',
            'TenMileRidge',
            'ThreeLakesWMA',
            'TMGoodwinWMA',
            'YuccaPensUnit',
            'krjackson',
            'cnrose',
            'jaberger',
            'lmtschantz',
            'baclark',
            'mllanos',
            'jlgreen',
            'adfarrell',
            'ecparrish',
            'yaetherly',
            'hjvastag',
            'TripleNRanchWMA',
            'SPDistrict1',
            'GuanaRiverWMA',
            'eegeoghegan',
            'lmlea',
            'nmmillerwright',
            'sadunn',
            'djkorkuc',
            'rohubbs',
            'slbechardsmith',
            'smbertone',
            'EscribanoPointWMA',
            'BrooksPreserveWEA',
            'BellRidgeLongleafWEA',
            'BabcockWebbWMA',
            'CrookedLakeWEA',
            'JoeBuddWMA',
            'HickeyCreekWEA',
            'LafayetteForestWEA',
            'LakeWalesRidgeWEA',
            'TatesHellWMA',
            'OfficeParkPlanning',
            'AucillaWMA',
            'mmgomez',
            'dmdawson',
            'jmeve',
            'ogaltwies',
            'tjjohnson',
            'cclewis',
            'jbwright1',
            'mlsummers',
            'dsbetz',
            'medaley',
            'krkneifl',
            'NPSCanaveral',
            'mehughes',
            'DinnerIslandRanchWMA',
            'ChassahowitzkaWMA',
            'FisheatingCreekWMA',
            'ApalachicolaRiverWEA',
            'ihhudson',
            'tlferraro',
            'tgzhou',
            'bbprioletti',
            'HuffmanBullCreekWMA',
            'terobinson',
            'jmjordan',
            'vloneil',
            'mabeary',
            'dmlorenz',
            'chsimmons',
            'cjwysocki',
            'clmartin',
            'jmtruitt',
            'cddavenport',
            'dcdintelmann',
            'cycummings',
            'ljhoos',
            'glgarrett',
            'FLStateParks',
            'rjkangas1',
            'sjbrehm',
            'jjpalumbo',
            'vvkirilova',
            'vgmerrill',
            'iaanderson',
            'laelligott',
            'sawilloughby',
            'bkbullard',
            'amdoying',
            'kasougstad',
            'eerosales',
            'cgfowler',
            'ajcorns',
            'dpowens',
            'kareading',
            'jjmoore',
            'klcannon',
            'amstevenson1',
            'vmpeddi',
            'lhsouth',
            'bsrolwing',
            'hmmonegro',
            'jldunn',
            'apthomas',
            'sdkaminer',
            'dlsiegrist',
            'rsparkis',
            'mtxarola',
            'npeinhoff',
            'tmhall',
            'jasalamone',
            'cglyons',
            'amramsby',
            'jkstokes7',
            'bmdora1',
            'pedavis',
            'tdgrantham',
            'mrjoyner',
            'srbozarth',
            'bewalborn',
            'gtpezzeminti',
            'ajbrady',
            'nrgrinnan1',
            'eejost',
            'sdcherian',
            'remoses',
            'bobrinck',
            'llanderson',
            'eapamblanco',
            'jmkramer',
            'jffalconer',
            'jmosborne',
            'mmdollar',
            'repost',
            'knkrosnick',
            'mafoote',
            'jlbalcolm',
            'clwilson',
            'sabowman',
            'tjcreamer1',
            'rdpowell',
            'dadumas',
            'arkent',
            'brpreserve',
            'kmcarter',
            'sbfaricy',
            'vlcolbert',
            'slstewart2',
            'dtjaffke',
            'cmdiff1',
            'cdiron wolf',
            'kagentry2',
            'cbblack',
            'HMSDatabase',
            'pngurin',
            'mjudden',
            'lmparks',
            'meharrold',
            'tcbowen',
            'twscofield',
            'zjharris',
            'ajschneider',
            'dmcummings',
            'maboye',
            'pjstreeter1',
            'dlkreiger',
            'waoppenheimer',
            'jlestevez',
            'geoakley',
            'techristopher',
            'ubaram',
            'bjmoore',
            'dascofield',
            'jdpomeroy',
            'HMSProgram',
            'rmwilson',
            'madugliss',
            'debowles',
            'jebundstein1',
            'jpbertine',
            'rjott',
            'cspierre',
            'valincoln1',
            'msthompson1',
            'admunn',
            'mshitchcock',
            'aawhitmore',
            'mlbeck',
            'mccorbett',
            'taparsons',
            'LakeOkeechobeeFWC',
            'lamagidson',
            'sperego',
            'chkuiper',
            'kdhiggins',
            'ammadeiros',
            'SWFWMD',
            'SRWMD',
            'lcparkerjackson',
            'BulowCreekSP',
            'HatchinehaRanchCBCE',
            'tknelson',
            'SPDistrict5',
            'klsears',
            'SPDistrict2',
            'TwinRiversSF',
            'BlackwaterRiverSF',
            'mlcalhoun1',
            'ccjohnson',
            'CharlotteHarborAP',
            'krboldenow',
            'anbryson',
            'TomokaSP',
            'hrtorres',
            'LAMP',
            'clnolan',
            'SFAdmin',
            'crboren4',
            'KissimmeeLakesWMA',
            'YuleeSugarMillRuinsHSP',
            'SFWMD',
            'WMDAdmin',
            'SPDistrict3',
            'dswoodward',
            'SPDistrict4',
            'LetchworthLoveMoundsSP',
            'LowerWekivaRiverPreserveSP',
            'recochrane',
            'PicayuneStrandSF',
            'FWCadmin',
            'rtbeyrle',
            'rnatal',
            'clmaltese',
            'letavasi1',
            'eplewis',
            'ljwatson',
            'wsbacheler1',
            'rgbarnett',
            'wrmoye',
            'rjneisler',
            'rlstowe',
            'nncastillo',
            'djthompson1',
            'mjstowe',
            'xmbermudez2',
            'jrwaters',
            'wblees',
            'ksmurray',
            'SPAdmin',
            'tscollore',
            'arlawson',
            'JohnPennekampCoralReefSP',
            'NorthCentral',
            'amcaines',
            'accox',
            'LignumvitaeKeyBotanicalSP',
            'EastCentral',
            'SJRWMD_North',
            'SJRWMD_NorthCentral',
            'SJRWMD_NorthRegion',
            'SJRWMD_SouthRegion',
            'SJRWMD_Southwest',
            'SJRWMD_West',
            'SJRWMD_SouthCentral',
            'awterango',
            'olgoodman',
            'TESTAP',
            'cwhowell',
            'PicayuneStrandWMA',
            'srschulze',
            'RuthBKirbySP',
            'rjtrimbath',
            'tsmoyer',
            'aswilkinson4',
            'ejgarrison',
            'ontserej vazquez',
            'asmarotz',
            'djkappelhoff',
            'GoetheWMA',
            'klthompson',
            'IchetuckneeTraceST',
            'kmoppen',
            'SanMarcosdeApalacheHSP',
            'PricesScrubSP',
            'aekelbaugh',
            'THStoneMemorialSP',
            'GoetheSF',
            'PointWashingtonSF',
            'PointWashingtonWMA',
            'ChoctawhatcheeRiverWMA',
            'DevilsHammockWMA',
            'GulfHammockWMA',
            'GroveParkWMA',
            'LochloosaWMA',
            'smdhruv',
            'SJRWMD_South',
            'PlankRoadSF',
            'jlshirk',
            'eedropiewski',
            'ecdillingham',
            'kawright',
            'erdhruv',
            'jcshannon',
            'sfschindler',
            'bmgolub',
            'hmthomas',
            'Southwest',
            'slschjelderup',
            'sjkergel',
            'drwuthrich',
            'mmhilpert',
            'dlbortel',
            'NWFWMD',
            'Southeast',
            'sezaia',
            'eggiles',
            'tcdawson',
            'hlburgess',
            'vmfreitas',
            'ssrogeriopereira',
            'FLSPArch',
            'BabcockRanchPreserve',
            'jjlyublanovits',
            'JonathanDickinsonSP',
            'lmwilliams',
            'sepierce',
            'semiller',
            'marrowsmith',
            'KoreshanStateHistoricSite',
            'GTMNERRGuanaRiverSite',
            'jcendonino',
            'Central',
            'slmurray',
            'rtdiaz',
            'rstillman',
            'Northeast',
            'kckemp',
            'aewagnerpelkey',
            'alab',
            'AnastasiaSP',
            'mmskidmore',
            'bawussick',
            'admin',
            'mcvernon',
            'jcwaters',
            'antheilacker',
            'ajgigantino',
            'tmmendez',
            'taburgoon',
            'SJRWMD_Admin',
            'sgmims',
            'tnskipton',
            'raluna',
            'jvarady',
            'rfernandez, iii',
            'naarce1',
            'Northwest',
            'sawilson1',
            'pgkerry',
            'spcardona1',
            'mrguzman',
            'agropp',
            'LMTest',
            'jrrobkin2',
            'ccjasiak',
            'smfuehr',
            'ekmartin1',
            'mmcoleman',
            'mnkoci',
            'drsmith',
            'mjferrell',
            'wdmargaritis',
            'hmrushing',
            'jlbach',
            'mkfield',
            'mmesenwein1',
            'dmdankenbring',
            'eebrazill',
            'jdfiske',
            'balyles',
            'SarasotaCounty',
            'dmhutchison',
            'laroberts',
            'mcgaillard',
            'FL_BAR_Collections',
            'wjwatford',
            'dmvihlen',
            'clricca',
            'bpburger',
            'whmiller',
            'eastebbins',
            'LMGuest',
            'lrsuthar',
            'cadaun',
            'dlervin',
            'rahuertas padilla',
            'mmmaris',
            'etadams',
            'nmmorales2',
            'mssanspree',
            'hmriveraclaudio',
            'kafulmer',
            'mdburnett',
            'drfogarty',
            'prdam',
            'AmeliaIslandSP',
            'ppoconnell',
            'avlarson',
            'q0wu',
            'dayrabarboza',
            'mbwagner',
            'spamy',
            'pjonesmorton',
            'tlray',
            'hrweltzien',
            'jlhunt',
            'EsteroBayPreserveSP',
            'zalepera',
            'mesanchez',
            'jjfamily',
            'cllavigne',
            'krminer',
            'majung',
            'uibaram',
            'slrowe',
            'rdharris',
            'nkbartosek',
            'lebyrne1',
            'AncloteKeyPreserveSP',
            'mlrusso',
            'dmfitzpatrick',
            'daroberts',
            'bobrinck1',
            'tmwestman',
            'phryan',
            'kpbjork',
            'kedickson',
            'ewgarcia',
            'dbfluegel1',
            'NewFPANCentralRegion',
            'vamccue',
            'emdavis',
            'capeacock',
            'jimoreno',
            'NewFMSF',
            'ltbulls',
            'aemcgill',
            'plmayhair',
            'tloverton',
            'tuuser',
            'rfboggs',
            'kmeckles',
            'teschnare',
            'amricks',
            'jlemory',
            'guest',
            'amstone',
            'coirizarry',
            'mlhilton',
            'meashbrook',
            'sffloyd',
            'mjrichardson',
            'mgcox',
            'jsholmes',
            'maromano',
            'FWC_NortheastRegion',
            'NewTomokaSP',
            'jarobinson',
            'HC_Manager',
            'mechandler',
            'dtmaurer',
            'hjgregory',
            'akblake',
            'NewFPANMultiRegion',
            'TalbotIslandsGEOpark',
            'pwskidmore',
            'atbryson',
            'rmharke',
            'elgiles',
            'crcrum',
            'sdyork',
            'lmyoder',
            'nemcauliffe',
            'jebeck',
            'jmroberts',
            'lalee',
            'dwroberts',
            'lachandler',
            'sllamb',
            'rilong',
            'machance',
            'dggaskinrivera',
            'clnewman',
            'drduncan',
            'jafittipaldi',
            'dltaylor',
            'kenussbaum',
            'pvbalanzategui',
            'gspaaso',
            'nfpfeifler',
            'rltucker',
            'gssmith',
            'sjduty',
            'rctaylor',
            'bclynch',
            'kemorphonios',
            'karocks',
            'smannis',
            'cmdriscoll',
            'fcvirciglio',
            'bhansen',
            'aiarmstrong',
            'jdcoates',
            'dakasriel',
            'dmwilson',
            'dlde posada',
        ]
